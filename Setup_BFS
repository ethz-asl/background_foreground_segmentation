### Setup BFS

# create conda virtual env
conda create -n bfs1 python=3.6
conda activate bfs1
cd ~/git/background_foreground_segmentation
pip install -r requirements.txt
pip install catkin_pkg (not in requirements)

# (if not done) install ROS as in http://wiki.ros.org/noetic/Installation/Ubuntu

# (if not done) install catkin_tools according to https://catkin-tools.readthedocs.io/en/latest/installing.html#installing-on-ubuntu-with-apt-get 
sudo apt install python3-catkin-tools

# Setup Catkin Workspace
mkdir -p ~/bfs_catkin_ws/src
cd ~/bfs_catkin_ws
catkin init

# Create symlink to git repo 
ln -s ~/git/background_foreground_segmentation/ ~/bfs_catkin_ws/src/

# use wstool to get dependencies from git (not sure if necessary)
sudo pip install -U wstool
wstool init src ~/git/background_forground_segmentation/dependencies.rosinstall
cd src

# for changes in dependencies: 
wstool merge ~/git/background_forground_segmentation/dependencies.rosinstall
wstool update 
chan

############# Fixes #######################
# Missing packages 
pip install empy (doesn't suffice to do it via apt-get python3-empy) 
sudo apt-get install libgmp3-dev
sudo apt-get install libmpfr3-dev
sudo apt install ros-noetic-geometric-shapes
pip install rospkg
pip install bfseg

# Missing opencv (C++), therefore installing it from source
cd ~/git
git clone https://github.com/opencv/opencv.git
mkdir -p build 
cd build
cmake ../opencv
make -j4

# Need opencv3, therefore installing it from source (opencv4 in /usr/include/, new opencv and opencv2 in /usr/local/include)
cd ~/git 
git clone https://github.com/opencv/opencv.git
cd opencv
git checkout 3.4.13 
mkdir build
cd build 
cmake .. -D CMAKE_INSTALL_PREFIX=/usr/local
make -j4
sudo make install
sudo sh -c 'echo "/usr/local/lib" >> /etc/ld.so.conf.d/opencv.conf'
############################################


# Build packages with catkin build
catkin config --cmake-args -DCMAKE_CXX_STANDARD=14 -DCMAKE_BUILD_TYPE=Debug (necessary for image_undistort, fix proposed by https://github.com/ros/catkin/issues/936, debug necessary for VSCode debug mode)
catkin build


# Setup NYU dataset for online learning
cd ~/bfs_catkin_ws/src/background_foreground_segmentation/src/bfseg/data
tfds build nyu_subsampled



### Run / Debug

conda activate bfs1
cd ~/bfs_catkin_ws
source devel/setup.bash
roslaunch src/background_foreground_segmentation/launch/rss_experiments/pickelhaube_segmentation_rumlang1.launch (for vscode inside ctrl+shift+p)
ros attach 



	







